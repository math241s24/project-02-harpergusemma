{
  "hash": "f6f16614424294fec6a1d64fb0460dac",
  "result": {
    "markdown": "---\ntitle: \"Fish Populations and Fish and Game Regulation in Alaska\"\nsubtitle: \"Project 2\"\nauthors: \"Emma Campbell, Gus Compton, Harper Lethin\"\nformat: html\neditor: visual\nruntime: shiny\n---\n\n\n\n## Introduction\n\nCommercial fishing in Alaska is a huge industry, as salmon is the main export product of the state after oil and natural gas. Commercial fishing contributes \\~5% of Alaska's economy, and salmon harvest in Alaska accounts for \\~80% of the total North American wild-caught salmon. Commercial fishing regulation changes combined with salmon habitat destruction and climate change leave fishermen and salmon enthusiasts constantly speculating about the effects of regulation changes on salmon populations.\n\nHowever, commercial salmon data is relatively inaccessible, and analysis of that data is even less accessible. Additionally, there is no existing public data set that examines the Alaska Fish and Game commercial fishing regulations. This project aims to give people a tool to examine the relationships between fish counts, permit/vessel/processor counts, and Fish and Game regulation sentiment analysis.\n\n## Methods: Data Wrangling\n\nTo obtain the text data from the [Alaska legislature](https://www.akleg.gov/basis/Home/BillsandLaws/32) on fishing, we scraped the website for all the bills within the \"Fish and Game\" subject. Using the `rvest` package and significant help from the Data Lab, we were able to scrape the site and create a data frame with each bill from each year on the subject of Fish and Game.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlegis <- read_csv(\"fish_and_game.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 428 Columns: 4\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (3): Name, Link, FULL_TEXT\ndbl (1): Legislature\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\nhead(legis)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n  Legislature Name    Link                                             FULL_TEXT\n        <dbl> <chr>   <chr>                                            <chr>    \n1          33 HB0020A https://www.akleg.gov/basis/Bill/Text/33?Hsid=H… \"\\n\\r\\n0…\n2          33 HB0039A https://www.akleg.gov/basis/Bill/Text/33?Hsid=H… \"\\n\\r\\n0…\n3          33 HB0040A https://www.akleg.gov/basis/Bill/Text/33?Hsid=H… \"\\n\\r\\n0…\n4          33 HB0042A https://www.akleg.gov/basis/Bill/Text/33?Hsid=H… \"\\n\\r\\n0…\n5          33 HB0054A https://www.akleg.gov/basis/Bill/Text/33?Hsid=H… \"\\n\\r\\n0…\n6          33 HB0064A https://www.akleg.gov/basis/Bill/Text/33?Hsid=H… \"\\n\\r\\n0…\n```\n:::\n:::\n\n\nWe then created a function which divided the `legis` dataset by line and subsetted it into the lines which contained a given keyword. The length of this subset was appended into a new dataframe providing the number of lines containing the keyword for each bill. This was then organized by year into `legis_word_longer`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nleng <- length(legis$Legislature)\n\ngetti <- function(word){\n  word_freq <- c()\n  for (i in 1:leng){ #looping through each bill\n    legis_line <- legis$FULL_TEXT[i] %>%\n    str_split(\"(?<=\\\\.)\\\\s*\") %>% \n    pluck(1) \n    word_freq_i <- legis_line %>%\n    str_subset(word) %>%\n    length()\n    word_freq <- append(word_freq, word_freq_i)\n  }\n  return(word_freq) #returns a vector of the keyword counts for each bill\n}\n\nlegis_word <- legis %>% \n  mutate(fish = getti(\"[F/f]ish\")) %>%\n  mutate(fisheries = getti(\"[F/f]isher[ies/y]\")) %>%\n  mutate(permit = getti(\"[P/p]ermit\")) %>%\n  mutate(vessel = getti(\"[V/v]essel\")) %>%\n  mutate(salmon = getti(\"[S/s]almon\")) %>%\n  mutate(limit = getti(\"[L/l]imit\")) \nlegis_word_longer <- legis_word %>% \n  select(-FULL_TEXT) %>%\n  pivot_longer(c('fish', 'fisheries', 'permit', 'vessel', 'salmon', 'limit'), names_to = \"word\", values_to = \"times_mentioned\") %>%\n  mutate(Year = Legislature) %>%\n  mutate(Year = case_when(\n    Legislature == 33 ~ 2023,\n    Legislature == 32 ~ 2021,\n    Legislature == 31 ~ 2019,\n    Legislature == 30 ~ 2017,\n    Legislature == 29 ~ 2015,\n    Legislature == 28 ~ 2013,\n    Legislature == 27 ~ 2011,\n    Legislature == 26 ~ 2009,\n    Legislature == 25 ~ 2007,\n    Legislature == 24 ~ 2005,\n    Legislature == 23 ~ 2003,\n    Legislature == 22 ~ 2001,\n    Legislature == 21 ~ 1999,\n    Legislature == 20 ~ 1997,\n    Legislature == 19 ~ 1995,\n    Legislature == 18 ~ 1993,\n    Legislature == 17 ~ 1991,\n    Legislature == 16 ~ 1989,\n    Legislature == 15 ~ 1987,\n    Legislature == 14 ~ 1985\n  ))\nhead(legis_word_longer)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 6\n  Legislature Name    Link                           word  times_mentioned  Year\n        <dbl> <chr>   <chr>                          <chr>           <int> <dbl>\n1          33 HB0020A https://www.akleg.gov/basis/B… fish                3  2023\n2          33 HB0020A https://www.akleg.gov/basis/B… fish…               3  2023\n3          33 HB0020A https://www.akleg.gov/basis/B… perm…               0  2023\n4          33 HB0020A https://www.akleg.gov/basis/B… vess…               0  2023\n5          33 HB0020A https://www.akleg.gov/basis/B… salm…               0  2023\n6          33 HB0020A https://www.akleg.gov/basis/B… limit               0  2023\n```\n:::\n:::\n\n\nSalmon data was sourced from the Alaska Department of Fish and Game website, which contains a dataset that includes the following variables per fishing area per year:\n\n-   Salmon species (Chinook, Chum, Coho, Pink, Sockeye)\n\n-   Number of fish landed\n\n-   Total weight of fish landed\n\n-   Number of issued commercial fishing permits\n\n-   Number of commercial fishing processor boats\n\n-   Number of commercial fishing vessels\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsalmon <- read_csv(\"salmondata/rawsalmon.csv\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 1902 Columns: 9\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (2): Area, Species Name\ndbl (7): Year, Number Of Fish (estimated), Landed Weight (lbs), Whole Weight...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\nsalmon <- salmon %>% rename(species = `Species Name`,\n                            num_fish = `Number Of Fish (estimated)`,\n                            land_weight = `Landed Weight (lbs)`,\n                            whole_weight = `Whole Weight (lbs)`,\n                            num_permit = `Permit Count`,\n                            num_processor = `Processor Count`,\n                            num_vessel = `Vessel Count`)\nwrite.csv(salmon, \"salmondata/salmon.csv\")\n```\n:::\n\n\nThis data was then used to create a shiny app that allows users to compare all variables in the salmon data set with each other, with the ability to isolate by specific salmon species if they are more interested in one than the others. This shiny app was created using the code written above the app in results.\n\nWe also compared data on text with fish count and permit count data by creating overlapping time series, to allow for qualitative assessments of potentially significant patterns. \n\n## Results\n\nA visualization of the word frequencies across all Alaska Department of Fish and Game bills shows that the words license, fisheries, conservation, and appropriations all appear more than 50,000 times cumulatively. This initial visualization shows the potential of our web-scraped word data frame from the fish and game regulations, and also shows that fish and game regulations appear to mention lots of commercial fishing-related topics.\n\n![](billwordfreq.png){fig-align=\"center\"}\n\nWe also found that the amount of different words used across time is variable, with large spikes in mentions of important fish related terms in 1998, 2005, 2017, and 2022. \n\n![](yearlyplot.png){fig-align=\"center\"}\n\nThe shiny app we created shows \n\n\n::: {.cell}\n\n```{.r .cell-code}\nui <- page_sidebar(\n  sidebar = sidebar(\n    varSelectInput(\"xvar\", \"X variable\", salmon, selected = \"Year\"),\n    varSelectInput(\"yvar\", \"Y variable\", salmon, selected = \"num_fish\"),\n    checkboxGroupInput(\n      \"species\", \"Filter by species\",\n      choices = unique(salmon$species), \n      selected = unique(salmon$species)\n    ),\n    hr(), # Add a horizontal rule\n    checkboxInput(\"by_species\", \"Show species\", TRUE),\n  ),\n  plotOutput(\"distPlot\")\n)\n\nserver <- function(input, output, session) {\n  subsetted <- reactive({\n    req(input$species)\n    salmon |> filter(species %in% input$species)\n  })\n  \n  output$distPlot <- renderPlot({\n    p <- ggplot(subsetted(), aes(!!input$xvar, !!input$yvar)) + list(\n      theme(legend.position = \"bottom\"),\n      if (input$by_species) aes(color = species),\n      geom_point(),\n      geom_smooth(method = 'lm')\n    )\n    \n    p\n  }, res = 100)\n}\n\nshinyApp(ui, server)\n```\n\n::: {.cell-output-display}\n`<iframe data-deferred-src=\"appe60fa154c722d2718b07efab654aa30b/?w=&amp;__subapp__=1\" width=\"100%\" height=\"400\" class=\"shiny-frame shiny-frame-deferred\"></iframe>`{=html}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}