---
title: "Fish Populations and Fish and Game Regulation in Alaska"
subtitle: "Project 2"
authors: "Emma Campbell, Gus Compton, Harper Lethin"
format: html
editor: visual
runtime: shiny
---

## Introduction

Commercial fishing in Alaska is a huge industry, as salmon is the main export product of the state after oil and natural gas. Commercial fishing contributes \~5% of Alaska's economy, and salmon harvest in Alaska accounts for \~80% of the total North American wild-caught salmon. Commercial fishing regulation changes combined with salmon habitat destruction and climate change leave fishermen and salmon enthusiasts constantly speculating about the effects of regulation changes on salmon populations.

However, commercial salmon data is relatively inaccessible, and analysis of that data is even less accessible. Additionally, there is no existing public data set that examines the Alaska Fish and Game commercial fishing regulations. This project aims to give people a tool to examine the relationships between fish counts, permit/vessel/processor counts, and Fish and Game regulation sentiment analysis.

## Methods: Data Wrangling

To obtain the text data from the [Alaska legislature](https://www.akleg.gov/basis/Home/BillsandLaws/32) on fishing, we scraped the website for all the bills within the "Fish and Game" subject. Using the `rvest` package and significant help from the Data Lab, we were able to scrape the site and create a data frame with each bill from each year on the subject of Fish and Game.

```{r}
#| include: false
library(tidyverse)
library(dplyr)
library(tidytext)
library(textdata)
library(tidymodels)
library(openintro)
library(mdsr)
library(mosaicData)
library(shiny)
library(bslib)
library(ggExtra)
library(quarto)
```

```{r}
legis <- read_csv("fish_and_game.csv")
head(legis)
```

We then created a function which divided the `legis` dataset by line and subsetted it into the lines which contained a given keyword. The length of this subset was appended into a new dataframe providing the number of lines containing the keyword for each bill. This was then organized by year into `legis_word_longer`.

```{r, echo=TRUE}
leng <- length(legis$Legislature)

getti <- function(word){
  word_freq <- c()
  for (i in 1:leng){ #looping through each bill
    legis_line <- legis$FULL_TEXT[i] %>%
    str_split("(?<=\\.)\\s*") %>% 
    pluck(1) 
    word_freq_i <- legis_line %>%
    str_subset(word) %>%
    length()
    word_freq <- append(word_freq, word_freq_i)
  }
  return(word_freq) #returns a vector of the keyword counts for each bill
}

legis_word <- legis %>% 
  mutate(fish = getti("[F/f]ish")) %>%
  mutate(fisheries = getti("[F/f]isher[ies/y]")) %>%
  mutate(permit = getti("[P/p]ermit")) %>%
  mutate(vessel = getti("[V/v]essel")) %>%
  mutate(salmon = getti("[S/s]almon")) %>%
  mutate(limit = getti("[L/l]imit")) 
legis_word_longer <- legis_word %>% 
  select(-FULL_TEXT) %>%
  pivot_longer(c('fish', 'fisheries', 'permit', 'vessel', 'salmon', 'limit'), names_to = "word", values_to = "times_mentioned") %>%
  mutate(Year = Legislature) %>%
  mutate(Year = case_when(
    Legislature == 33 ~ 2023,
    Legislature == 32 ~ 2021,
    Legislature == 31 ~ 2019,
    Legislature == 30 ~ 2017,
    Legislature == 29 ~ 2015,
    Legislature == 28 ~ 2013,
    Legislature == 27 ~ 2011,
    Legislature == 26 ~ 2009,
    Legislature == 25 ~ 2007,
    Legislature == 24 ~ 2005,
    Legislature == 23 ~ 2003,
    Legislature == 22 ~ 2001,
    Legislature == 21 ~ 1999,
    Legislature == 20 ~ 1997,
    Legislature == 19 ~ 1995,
    Legislature == 18 ~ 1993,
    Legislature == 17 ~ 1991,
    Legislature == 16 ~ 1989,
    Legislature == 15 ~ 1987,
    Legislature == 14 ~ 1985
  ))
head(legis_word_longer)
```

Salmon data was sourced from the Alaska Department of Fish and Game website, which contains a dataset that includes the following variables per fishing area per year:

-   Salmon species (Chinook, Chum, Coho, Pink, Sockeye)

-   Number of fish landed

-   Total weight of fish landed

-   Number of issued commercial fishing permits

-   Number of commercial fishing processor boats

-   Number of commercial fishing vessels

```{r}
salmon <- read_csv("salmondata/rawsalmon.csv")


salmon <- salmon %>% rename(species = `Species Name`,
                            num_fish = `Number Of Fish (estimated)`,
                            land_weight = `Landed Weight (lbs)`,
                            whole_weight = `Whole Weight (lbs)`,
                            num_permit = `Permit Count`,
                            num_processor = `Processor Count`,
                            num_vessel = `Vessel Count`)
write.csv(salmon, "salmondata/salmon.csv")
```

This data was then used to create a shiny app that allows users to compare all variables in the salmon data set with each other, with the ability to isolate by specific salmon species if they are more interested in one than the others. This shiny app was created using the code written above the app in results.

We also compared data on text with fish count and permit count data by creating overlapping time series, to allow for qualitative assessments of potentially significant patterns.

## Results

A visualization of the word frequencies across all Alaska Department of Fish and Game bills shows that the words license, fisheries, conservation, and appropriations all appear more than 50,000 times cumulatively. This initial visualization shows the potential of our web-scraped word data frame from the fish and game regulations, and also shows that fish and game regulations appear to mention lots of commercial fishing-related topics.

![](billwordfreq.png){fig-align="center", width = 300px}

We also found that the amount of different words used across time is variable, with large spikes in mentions of important fish related terms in 1998, 2005, 2017, and 2022.

![](yearlyplot.png){fig-align="center", width = 300px} In the figure below, comparisons of fish count (blue histogram) and the amount of times that fish were mentioned in the legislature (black line) showed no significant similarities, except for an interesting peak in the amount of times fish were mentioned in 1998 co-occuring with a dip in fish count.

![](wordsandfish.png){fig-align="center", width = 300px}

In the figure below, comparisons of fish count (blue histogram) and the amount of times that permits were mentioned in the legislature (black line) also showed no significant similarities.

![](wordsandpermit.png){fig-align="center", width = 300px}

The shiny app we created shows how fish count, fish weight, processor count, permit count, vessel count and others compare as well as how they change across time. Interestingly, permit count decreased across time but fish counts didn't. This means perhaps that fish count per permit is increasing across time. If app is not visible on document, run this page in r or run app.R in salmonapp folder in repository to see finished app.

```{r shiny_app}
ui <- page_sidebar(
  sidebar = sidebar(
    varSelectInput("xvar", "X variable", salmon, selected = "Year"),
    varSelectInput("yvar", "Y variable", salmon, selected = "num_fish"),
    checkboxGroupInput(
      "species", "Filter by species",
      choices = unique(salmon$species), 
      selected = unique(salmon$species)
    ),
    hr(), # Add a horizontal rule
    checkboxInput("by_species", "Show species", TRUE),
  ),
  plotOutput("distPlot")
)

server <- function(input, output, session) {
  subsetted <- reactive({
    req(input$species)
    salmon |> filter(species %in% input$species)
  })
  
  output$distPlot <- renderPlot({
    p <- ggplot(subsetted(), aes(!!input$xvar, !!input$yvar)) + list(
      theme(legend.position = "bottom"),
      if (input$by_species) aes(color = species),
      geom_point(),
      geom_smooth(method = 'lm')
    )
    
    p
  }, res = 100)
}

shinyApp(ui, server)
```
